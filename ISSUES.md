# プロジェクトの問題点

このドキュメントは、`HmCustomRenderBrowser` プロジェクトにおける現在の実装の問題点をまとめたものです。

## 1. 【重大】クライアントからサーバーへのデータ送信がGETリクエストで行われている

現在、ブラウザ（クライアント）から秀丸エディタ（サーバー）へデータを送信する `sendObject` 関数は、HTTP GETリクエストを使用しています。データはURLのクエリパラメータとしてエンコードされます。

- **問題点:**
  - URLには長さの制限（ブラウザやサーバーによって異なるが、一般的に2048文字程度）があります。
  - 大量のテキストや複雑なオブジェクトなど、送信するデータがこの制限を超えると、データが切り捨てられたり、リクエスト全体が失敗したりする可能性があります。
  - これは、このフレームワークの安定性と信頼性を著しく損なう致命的な欠陥です。

- **影響ファイル:**
  - `HmCustomRenderBrowser.js`
  - `HmCustomRenderServer.js`
  - `HmCustomRenderServer.WebView2.js`

- **推奨される解決策:**
  - `sendObject` 関数を、データをリクエストボディに含めることができる **HTTP POSTリクエスト** を使用するように変更します。
  - それに伴い、サーバーサイドのスクリプトもPOSTリクエストを正しく処理できるように修正する必要があります。

## 2. 【中程度】サーバーサイドでのエラー隠蔽

サーバーサイドのスクリプトは、クライアントからデータを受信した際に発生したエラーを完全に無視（隠蔽）しています。

- **問題点:**
  - `_proxyOnReceiveObjectFromRenderPane` 関数内の `try...catch` ブロックの `catch` 節が空になっています。
  - これにより、クライアントから送信されたJSONデータの形式が不正であったり、データ受信後の処理 (`onReceiveObject`) でエラーが発生したりしても、**何もログが記録されず、エラーが起きたこと自体を検知できません。**
  - これは、このフレームワークを利用する開発者のデバッグ作業を著しく困難にします。

- **影響ファイル:**
  - `HmCustomRenderServer.js`
  - `HmCustomRenderServer.WebView2.js`

- **推奨される解決策:**
  - `catch` ブロック内で、エラーオブジェクトの内容を `_outputAlert` などの手段を用いて出力し、エラーが発生したことを開発者が認識できるようにします。

## 3. 【軽微】その他の問題点

上記に加えて、コードの品質と保守性に関するいくつかの軽微な問題が存在します。

- **コードスタイルと使用言語の不統一:**
  - サーバーサイド (`.js`) は古いJScript（ECMAScript 3相当）で書かれている一方、クライアントサイド (`HmCustomRenderBrowser.js`) はモダンなJavaScript（ES6+）で書かれています。
  - この不統一性は、プロジェクト全体の保守性を低下させる要因となります。

- **グローバル変数の使用:**
  - `_httpServer1`, `_httpServer2` などのグローバル変数が使用されています。
  - これは、他のスクリプトとの意図しない競合を引き起こす可能性があります。クラスやモジュールパターンを用いて、状態をカプセル化することが望ましいです。

- **不安定なAPIへの場当たり的な対応:**
  - `HmCustomRenderServer.WebView2.js` 内に `// ここはパッチだと思って!!` というコメントと共に、APIの不安定な挙動を吸収するためのコードが存在します。
  - このような場当たり的な修正は、将来的なバグの原因となり得ます。

- **ドキュメントの不足:**
  - `sendObject` と `sendObjectFromRenderPane` の機能的な違いや、それぞれの使用場面についての説明が不足しています。特にWebView2環境での使い分けが不明確です。
